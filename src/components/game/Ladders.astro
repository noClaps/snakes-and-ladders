---
interface Props {
    laddersArray: number[][];
}

const { laddersArray } = Astro.props;
---

<canvas
    hx-get="/partials/update-ladders"
    hx-trigger="click from:#reset"
    hx-swap="outerHTML"
    id="ladders"
    data-ladders={JSON.stringify(laddersArray)}></canvas>

<style>
    canvas {
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
    }
</style>

<script>
    const canvas = document.querySelector<HTMLCanvasElement>("#ladders")!;
    const ctx = canvas.getContext("2d")!;
    const ladders: number[][] = JSON.parse(canvas.dataset.ladders!);

    canvas.width = document.documentElement.clientWidth;
    canvas.height = document.documentElement.clientHeight;

    for (const ladder of ladders) {
        const square0 = document
            .querySelector(`#position-${ladder[0]}`)!
            .getBoundingClientRect();
        const square1 = document
            .querySelector(`#position-${ladder[1]}`)!
            .getBoundingClientRect();

        const x0 = square0.x + square0.width / 2;
        const y0 = square0.y + square0.height / 2;
        const x1 = square1.x + square1.width / 2;
        const y1 = square1.y + square1.height / 2;

        ctx.beginPath();
        ctx.lineWidth = 2;
        ctx.strokeStyle = "white";
        ctx.moveTo(x0, y0);
        ctx.lineTo(x1, y1);
        ctx.stroke();
    }
</script>
